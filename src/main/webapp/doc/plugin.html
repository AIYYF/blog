<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="../static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="../static/css/sb-admin-2.css">
<link href="../static/prettify/github-v2.min.css" rel="stylesheet">
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="../static/js/html5shiv.min.js"></script>
      <script src="../static/js/respond.min.js"></script>
    <![endif]-->
<style>
body {
	word-wrap: break-word;
}
</style>
</head>
<body onload="prettyPrint();">
	<div id="nav"></div>

	<div id="page-wrapper" style="padding: 10px">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<h3>1.插件结构</h3>
					<h4>逻辑代码</h4>
					<div>
						插件的所有的逻辑代码都要处于
						<code>me.qyh.blog.plugin.{pluginName}</code>
						包下， 例如插件名称为 test，那么代码应处于
						<code>me.qyh.blog.plugin.test</code>
						包下。下面几个包中的类将会被自动扫描注册为spring bean：
						<div class="table-responsive">
							<table class="table">
								<tr>
									<th>me.qyh.blog.plugin.test.dao</th>
									<td>存放dao类</td>
								</tr>
								<tr>
									<th>me.qyh.blog.plugin.test.service</th>
									<td>存放逻辑处理类</td>
								</tr>
								<tr>
									<th>me.qyh.blog.plugin.test.mapper</th>
									<td>存放mybaits mapper.xml文件</td>
								</tr>
								<tr>
									<th>me.qyh.blog.plugin.test.validator</th>
									<td>存放validator类</td>
								</tr>
								<tr>
									<th>me.qyh.blog.plugin.test.controller</th>
									<td>存放处理器类</td>
								</tr>
								<tr>
									<th>me.qyh.blog.plugin.test.component</th>
									<td>存放组件类</td>
								</tr>
							</table>
						</div>
						<p class="alert alert-warning">
							上述几个包都应该是
							<code>me.qyh.blog.plugin.test</code>
							的直接子包才会被自动扫描，例如
							<code>me.qyh.blog.plugin.test.a.dao</code>
							就不会被扫描注册
						</p>
					</div>
					<h4>页面</h4>
					<p>插件额外的页面都应处于 WEB-INF/templates/plugin/{pluginName} 文件夹下</p>

					<h4>静态资源</h4>
					<p>插件额外的静态资源都应处于 webapp/static/plugin/{pluginName} 文件夹下</p>

					<h3>2.PluginHandler</h3>
					<p>
						<code>PluginHandler</code>
						实现于
						<code>me.qyh.blog.plugin.PluginHandler</code>
						，或者 继承自
						<code>me.qyh.blog.plugin.PluginHandlerAdapter</code>
						，一个插件只能拥有一个PluginHandler，该类必须要处于
						<code>me.qyh.blog.plugin.{pluginName}</code>
						包下，名称一般为
						<code>${pluginName}PluginHandler</code>
						，PluginHandler方法如下：
					</p>
					<div class="table-responsive">
						<table class="table">
							<tr>
								<td>void initialize(ConfigurableApplicationContext applicationContext)</td>
								<td>在ApplicationContext初始化前调用</td>
							</tr>
							<tr>
								<td>void init(ApplicationContext applicationContext)</td>
								<td>当ApplicationContext<b>加载完成后</b>，初始化插件时调用</td>
							</tr>
							<tr>
								<td>void addDataTagProcessor(DataTagProcessorRegistry
									registry)</td>
								<td>添加DataTagProcessor，用于页面的调用</td>
							</tr>
							<tr>
								<td>void addTemplate(TemplateRegistry registry)</td>
								<td>添加<b>系统模板</b>，如果存在对应路径的系统模板，将会替换该系统模板，但是无法替换用户模板 <br>添加<b>全局模板片段</b>，如果存在对应名称的模板片段，将会替换该模板片段，但是无法替换用户自定义模板片段
								</td>
							</tr>
							<tr>
								<td>void addRequestHandlerMapping(RequestMappingRegistry
									registry);</td>
								<td>添加RequestHandlerMapping，主要用于逻辑处理之后的注册，如果不需要逻辑处理，那么应该首先通过
									<code>me.qyh.blog.plugin.{pluginName}.controller</code>注册controller来处理
								</td>
							</tr>
							<tr>
								<td>void addMenu(MenuRegistry registry)</td>
								<td>添加管理台左侧导航的菜单链接，<b>虽然Menu为树结构，但是最多支持2层菜单</b></td>
							</tr>
							<tr>
								<td>void addExceptionHandler(ExceptionHandlerRegistry
									registry)</td>
								<td>添加自定义的异常处理器，<b>优先级低于系统的异常处理器，并且只能处理checked异常</b></td>
							</tr>
							<tr>
								<td>void
									addArticleContentHandler(ArticleContentHandlerRegistry
									registry)</td>
								<td>添加文章内容处理器</td>
							</tr>
							<tr>
								<td>void
									addCommentModuleHandler(CommentModuleHandlerRegistry registry)</td>
								<td>添加评论模块处理器</td>
							</tr>
							<tr>
								<td>void addCommentChecker(CommentCheckerRegistry registry)
								</td>
								<td>添加评论校验器</td>
							</tr>
							<tr>
								<td>void addFileStore(FileStoreRegistry registry)</td>
								<td>添加额外的文件存储</td>
							</tr>
							<tr>
								<td>void addTemplateInterceptor(TemplateInterceptorRegistry
									registry)</td>
								<td>添加模板拦截器</td>
							</tr>
							<tr>
								<td>void
									addHandlerInterceptorRegistry(HandlerInterceptorRegistry
									registry)</td>
								<td>添加拦截器,<b>优先级低于系统自带的拦截器</b></td>
							</tr>
						</table>
					</div>
					<h3>3.PluginBuilder</h3>
					<p>
						通过
						<code>PluginBuilder#builder</code>
						方法可以打包制作好的插件
					</p>

				</div>
			</div>
		</div>
	</div>
</body>

<script type="text/javascript" src="../static/jquery/jquery.min.js"></script>
<script type="text/javascript"
	src="../static/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../static/prettify/prettify.js"></script>
<script>
	$(function() {
		$("#nav").load("nav.html");
	});
</script>
</html>